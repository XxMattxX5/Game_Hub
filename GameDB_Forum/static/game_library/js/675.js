"use strict";(self.webpackChunkgame_library=self.webpackChunkgame_library||[]).push([[675],{7675:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var r=a(6540),l=a(8239),i=a(4073),n=a(2848),s=a(2567),o=a(6990),m=a(7059),c=a(6179),_=a(4976),p=a(4147),u=a(1083),d=a(8987);function f(){const{logoutUser:e}=(0,p.A)(),[t,a]=(0,r.useState)({}),[f,E]=(0,r.useState)(""),[A,g]=(0,r.useState)(""),[h,y]=(0,r.useState)(null),[b,w]=(0,r.useState)(""),[v,x]=(0,r.useState)(""),[C,S]=(0,r.useState)({error1:"",error2:""}),[k,N]=(0,r.useState)([]);(0,r.useEffect)((()=>{U()}),[]);const U=async()=>{try{const e=await u.A.get("/api/get_profile/");a(e.data),E(e.data.user.username),g(e.data.user.email),N(e.data.posts.post_list)}catch(e){throw new Error("Failed to fetch user profile")}};return r.createElement(l.Ay,{container:!0},r.createElement(l.Ay,{item:!0,xs:10,id:"profile_main_content_box"},r.createElement(l.Ay,{item:!0,xs:3,id:"profile_info_bar"},r.createElement(l.Ay,{item:!0,id:"profile_info_bar_header"},r.createElement(i.A,{variant:"h4"},"Profile Info")),r.createElement(l.Ay,{item:!0,id:"profile_bar_image"},r.createElement("img",{src:t.user?"/media/"+t.user.profile_pic:null})),r.createElement(l.Ay,{item:!0,id:"profile_bar_username"},r.createElement(i.A,null,"Username:",t.user?" "+t.user.username:"")),r.createElement(l.Ay,{item:!0,id:"profile_bar_email"},r.createElement(i.A,null,"Email:",t.user?" "+t.user.email:"")),r.createElement(l.Ay,{item:!0,id:"profile_bar_posts"},r.createElement(i.A,null,"Posts Made:",t.posts?" "+t.posts.post_count:0)),r.createElement(l.Ay,{item:!0,id:"profile_bar_member_since"},r.createElement(i.A,null,"Member Since:",t.user?" "+(F=t.user.date_joined,F=new Date(F),F=String(F.getMonth())+"/"+String(F.getDate())+"/"+String(F.getFullYear())):""))),r.createElement(l.Ay,{item:!0,xs:9,id:"profile_box"},r.createElement(l.Ay,{item:!0,xs:5.5,id:"profile_user_info"},r.createElement(l.Ay,{item:!0,xs:12,id:"profile_change_profile_pic"},r.createElement(n.A,{id:"profile_upload_success_message",in:""!==b},r.createElement(s.A,{severity:"success",onClose:()=>w("")},b)),r.createElement(l.Ay,{item:!0,id:"profile_image_preview"},r.createElement("img",{src:h||(t.user?"/media/"+t.user.profile_pic:null)})),r.createElement(l.Ay,{item:!0,id:"profile_input_pic"},r.createElement("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files[0];t&&(e=>{const t=new FileReader;t.onload=e=>{const t=new Image;t.onload=()=>{const e=document.createElement("canvas");let a=t.width,r=t.height;a>r?a>120&&(r=Math.round(r*=120/a),a=120):r>120&&(a=Math.round(a*=120/r),r=120),e.width=a,e.height=r,e.getContext("2d").drawImage(t,0,0,a,r);const l=e.toDataURL("image/jpeg");y(l)},t.src=e.target.result},t.readAsDataURL(e)})(t)}}),r.createElement(o.A,{id:"profile_save_pic",onClick:async()=>{if(h)try{await u.A.post("/api/update_profile_pic/",{image:h},{headers:{"Content-Type":"application/json","X-CSRFToken":d.A.get("csrftoken")}}),U(),w("Profile image was updated!"),y(null)}catch(e){if(401!==e.response.status)throw new Error("Failed to upload image")}}},r.createElement(i.A,null,"Save Picture")))),r.createElement(l.Ay,{item:!0,id:"profile_change_info_box"},r.createElement(i.A,{variant:"h4",id:"profile_change_user_header"},"Change User Information"),r.createElement(n.A,{id:"profile_info_change_success",in:""!==v},r.createElement(s.A,{severity:"success",onClose:()=>x("")},v)),r.createElement(l.Ay,{item:!0,id:"profile_new_username_box",xs:10},r.createElement(m.A,{id:"profile_new_username",label:"Enter Username",value:f,size:"small",onChange:e=>{E(e.target.value)},fullWidth:!0})),C.error1?r.createElement(i.A,{class:"profile_errors"},C.error1):null,r.createElement(l.Ay,{item:!0,id:"profile_new_email_box",xs:10},r.createElement(m.A,{id:"profile_new_email",label:"Enter Email",value:A,size:"small",onChange:e=>{g(e.target.value)},fullWidth:!0})),C.error2?r.createElement(i.A,{class:"profile_errors"},C.error2):null,r.createElement(l.Ay,{item:!0,id:"profile_save_info_changes",xs:10},r.createElement(o.A,{id:"profile_save_info_button",onClick:async()=>{if(f!=t.user.username||A!=t.user.email)try{await u.A.post("/api/update_user_info/",{username:f,email:A},{headers:{"Content-Type":"application/json","X-CSRFToken":d.A.get("csrftoken")}}),U(),x("User Info was Updated!"),S({})}catch(t){401===response.status?e():S(t.response.data.error)}}},r.createElement(i.A,null,"Save Changes"))))),r.createElement(l.Ay,{item:!0,xs:5.5,id:"profile_postlist"},r.createElement(i.A,{variant:"h4",id:"profile_post_list_title"},"Posts Created"),r.createElement(l.Ay,{item:!0,id:"profile_post_list_box"},k.map((e=>r.createElement(l.Ay,{item:!0,xs:11,key:e.created_at,className:"profile_post_bar"},r.createElement(_.N_,{className:"profile_post_bar_link",to:`/forum/${e.game?"games":"general"}/post/${e.id}`},r.createElement(l.Ay,{item:!0,className:"profile_post_headers"},r.createElement(i.A,{className:"profile_post_username"},e.author_username),r.createElement("span",{className:"post_header_divider"},"|"),r.createElement(i.A,{className:"profile_post_created_at"},(e=>"Posted "+(e=(0,c.B)(new Date(e),{addSuffix:!1}))+" ago")(e.created_at)),e.game?r.createElement("span",{className:"post_header_divider"},"|"):null,r.createElement(i.A,{className:"profile_post_game"},e.game?e.game.name:null)),r.createElement(l.Ay,{item:!0,className:"profile_post_title"},r.createElement(i.A,null,e.title)))))))))));var F}}}]);